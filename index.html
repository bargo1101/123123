<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>VOID LAUNCH ‚Äî Phantom Mobile</title>

  <!-- Solana libs -->
  <script src="https://unpkg.com/@solana/web3.js@1.95.3/lib/index.iife.min.js"></script>
  <script src="https://unpkg.com/@solana/spl-token@0.4.8/lib/index.iife.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/buffer@6.0.3/index.min.js"></script>

  <style>
    body {
      margin:0;
      min-height:100vh;
      background:#000;
      color:#0ff;
      font-family:monospace;
      display:flex;
      justify-content:center;
      align-items:center;
    }
    .box {
      width:100%;
      max-width:420px;
      padding:20px;
      border:1px solid #ff00aa;
      border-radius:10px;
      background:#05000a;
    }
    h1 { text-align:center; margin-bottom:10px }
    button, input, select {
      width:100%;
      margin-top:8px;
      padding:10px;
      border-radius:6px;
      border:none;
      font-weight:bold;
    }
    button { background:#ff00aa; color:#000 }
    .log {
      margin-top:12px;
      padding:10px;
      font-size:13px;
      background:#000;
      border:1px dashed #ff00aa;
      max-height:200px;
      overflow:auto;
    }
  </style>
</head>

<body>
<div class="box">
  <h1>VOID LAUNCH</h1>

  <button id="connect">CONNECT PHANTOM</button>

  <form id="form" style="display:none">
    <input id="symbol" placeholder="SYMBOL" maxlength="10" required />
    <input id="supply" type="number" placeholder="SUPPLY" required />
    <select id="decimals">
      <option value="9">9</option>
      <option value="6">6</option>
      <option value="0">0</option>
    </select>
    <button type="submit">MINT TOKEN</button>
  </form>

  <div id="log" class="log"></div>
</div>

<script>
window.Buffer = buffer.Buffer;

const { Connection, Keypair, Transaction, SystemProgram } = solanaWeb3;
const {
  TOKEN_PROGRAM_ID,
  MINT_SIZE,
  createInitializeMintInstruction,
  getAssociatedTokenAddress,
  createAssociatedTokenAccountInstruction,
  createMintToInstruction,
  createSetAuthorityInstruction,
  AuthorityType
} = splToken;

const connection = new Connection(
  "https://api.mainnet-beta.solana.com",
  "confirmed"
);

const connectBtn = document.getElementById("connect");
const form = document.getElementById("form");
const logBox = document.getElementById("log");

let provider = null;
let wallet = null;

function log(msg) {
  logBox.innerHTML = msg + "<br>" + logBox.innerHTML;
}

/* ====== PHANTOM CONNECT (MOBILE SAFE) ====== */
connectBtn.onclick = async () => {
  if (!window.solana || !window.solana.isPhantom) {
    log("‚ùå Open this page inside Phantom browser");
    return;
  }

  try {
    provider = window.solana;
    const res = await provider.connect(); // DIRECT USER GESTURE
    wallet = res.publicKey;
    log("‚úÖ Connected: " + wallet.toBase58());
    connectBtn.style.display = "none";
    form.style.display = "block";
  } catch {
    log("‚ùå Connection rejected");
  }
};

/* ====== MINT FLOW ====== */
form.onsubmit = async (e) => {
  e.preventDefault();

  const symbol = document.getElementById("symbol").value.trim();
  const supply = BigInt(document.getElementById("supply").value);
  const decimals = Number(document.getElementById("decimals").value);

  try {
    log("‚è≥ Preparing mint...");

    const mint = Keypair.generate();
    const lamports = await connection.getMinimumBalanceForRentExemption(MINT_SIZE);
    const total = supply * (10n ** BigInt(decimals));

    const tx = new Transaction().add(
      SystemProgram.createAccount({
        fromPubkey: wallet,
        newAccountPubkey: mint.publicKey,
        space: MINT_SIZE,
        lamports,
        programId: TOKEN_PROGRAM_ID
      }),
      createInitializeMintInstruction(
        mint.publicKey,
        decimals,
        wallet,
        wallet
      )
    );

    const ata = await getAssociatedTokenAddress(mint.publicKey, wallet);
    tx.add(
      createAssociatedTokenAccountInstruction(wallet, ata, wallet, mint.publicKey),
      createMintToInstruction(mint.publicKey, ata, wallet, total),
      createSetAuthorityInstruction(mint.publicKey, wallet, AuthorityType.MintTokens, null),
      createSetAuthorityInstruction(mint.publicKey, wallet, AuthorityType.FreezeAccount, null)
    );

    tx.feePayer = wallet;
    tx.recentBlockhash = (await connection.getLatestBlockhash()).blockhash;
    tx.partialSign(mint);

    log("‚úçÔ∏è Requesting signature...");
    const signed = await provider.signTransaction(tx);
    const sig = await connection.sendRawTransaction(signed.serialize());

    log("üöÄ Sent: " + sig);
    await connection.confirmTransaction(sig, "confirmed");

    log("‚úÖ SUCCESS ‚Äî Mint: " + mint.publicKey.toBase58());
  } catch (err) {
    log("‚ùå ERROR: " + err.message);
  }
};
</script>
</body>
</html>
