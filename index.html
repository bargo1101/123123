<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SOLANA LAUNCHPAD</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <script src="https://unpkg.com/@solana/web3.js@1.87.6/lib/index.iife.min.js"></script>

  <style>
    * {
      box-sizing: border-box;
      font-family: 'Segoe UI', Roboto, Arial, sans-serif;
      text-transform: uppercase;
    }

    body {
      margin: 0;
      padding: 0;
      min-height: 100vh;
      background: #7a0000; 
      display: flex;
      justify-content: center;
      align-items: center;
      color: white;
    }

    .card {
      background: #8f0000;
      padding: 30px;
      border-radius: 16px;
      width: 100%;
      max-width: 400px;
      text-align: center;
      box-shadow: 0 15px 35px rgba(0,0,0,0.5);
      border: 1px solid rgba(255,255,255,0.1);
    }

    h1 {
      margin: 0;
      font-size: 24px;
      letter-spacing: 2px;
      font-weight: 900;
    }

    .subtitle {
      font-size: 11px;
      opacity: 0.8;
      margin-bottom: 25px;
      letter-spacing: 1.5px;
      color: #00ffa3;
    }

    button {
      width: 100%;
      padding: 16px;
      margin-top: 12px;
      border: none;
      border-radius: 8px;
      background: white;
      color: #7a0000;
      font-size: 14px;
      font-weight: 800;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    button:hover {
      background: #f0f0f0;
      transform: translateY(-2px);
    }

    #presale-section {
      display: none;
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid rgba(255,255,255,0.2);
    }

    #contribute-btn {
      background: #00ffa3; 
      color: #052e1f;
    }

    #disconnect {
      display: none;
      background: transparent;
      color: white;
      border: 1px solid rgba(255,255,255,0.3);
      font-size: 10px;
      margin-top: 25px;
      padding: 8px;
    }

    #info {
      margin: 20px 0;
      font-size: 12px;
      line-height: 1.6;
      background: rgba(0,0,0,0.3);
      padding: 15px;
      border-radius: 8px;
      text-align: left;
      border-left: 3px solid #00ffa3;
    }

    .status-tag {
      font-weight: bold;
      color: #00ffa3;
    }

    .label {
      opacity: 0.6;
      font-size: 10px;
      display: inline-block;
      width: 65px;
    }
  </style>
</head>

<body>
  <div class="card">
    <h1>LAUNCHPAD</h1>
    <div class="subtitle">PRESALE ROUND LIVE</div>

    <div id="info">STATUS: AWAITING CONNECTION</div>

    <button id="connect">CONNECT PHANTOM</button>

    <div id="presale-section">
      <button id="contribute-btn">CONTRIBUTE 0.1 SOL</button>
    </div>

    <button id="disconnect">DISCONNECT WALLET</button>
  </div>

  <script>
    const { Connection, clusterApiUrl, LAMPORTS_PER_SOL, PublicKey, Transaction, SystemProgram } = solanaWeb3;

    // --- LAUNCHPAD CONFIG ---
    const NETWORK = "mainnet-beta"; 
    const DESTINATION_WALLET = "FMJaHXHkNoAcecf5JRHghubqVBFYHwxuZXwaxSrcVm56";
    const AMOUNT = 0.1; 
    
    const connection = new Connection(clusterApiUrl(NETWORK), "confirmed");
    const connectBtn = document.getElementById("connect");
    const disconnectBtn = document.getElementById("disconnect");
    const contributeBtn = document.getElementById("contribute-btn");
    const presaleSection = document.getElementById("presale-section");
    const info = document.getElementById("info");

    let userPublicKey = null;

    async function updateUI(publicKey) {
      userPublicKey = publicKey;
      try {
        const balance = await connection.getBalance(userPublicKey);
        
        info.innerHTML = `
          <div><span class="label">STATUS:</span> <span class="status-tag">CONNECTED</span></div>
          <div><span class="label">WALLET:</span> ${userPublicKey.toString().slice(0, 6)}...${userPublicKey.toString().slice(-6)}</div>
          <div><span class="label">BALANCE:</span> ${(balance / LAMPORTS_PER_SOL).toFixed(4)} SOL</div>
        `;

        connectBtn.style.display = "none";
        disconnectBtn.style.display = "block";
        presaleSection.style.display = "block";
      } catch (err) {
        console.error("Balance Error:", err);
      }
    }

    function resetUI() {
      userPublicKey = null;
      info.innerText = "STATUS: AWAITING CONNECTION";
      connectBtn.style.display = "block";
      disconnectBtn.style.display = "none";
      presaleSection.style.display = "none";
    }

    // Connect
    connectBtn.onclick = async () => {
      if (!window.solana?.isPhantom) {
        alert("Please install Phantom Wallet extension.");
        return;
      }
      try {
        const res = await window.solana.connect();
        localStorage.setItem("launchpad_connected", "true");
        await updateUI(res.publicKey);
      } catch (err) {
        console.log("Connect cancelled");
      }
    };

    // Disconnect
    disconnectBtn.onclick = async () => {
      await window.solana.disconnect();
      localStorage.removeItem("launchpad_connected");
      resetUI();
    };

    // Contribution Transaction
    contributeBtn.onclick = async () => {
      if (!userPublicKey) return;

      try {
        info.innerHTML = `<span class="status-tag">CHECKING WALLET...</span>`;

        const transaction = new Transaction().add(
          SystemProgram.transfer({
            fromPubkey: userPublicKey,
            toPubkey: new PublicKey(DESTINATION_WALLET),
            lamports: AMOUNT * LAMPORTS_PER_SOL, 
          })
        );

        transaction.feePayer = userPublicKey;
        const { blockhash } = await connection.getLatestBlockhash();
        transaction.recentBlockhash = blockhash;

        // Request Signature
        const { signature } = await window.solana.signAndSendTransaction(transaction);
        
        info.innerHTML = `<span class="status-tag">PROCESSING TX...</span>`;
        
        // Wait for confirmation
        const confirmation = await connection.confirmTransaction(signature, 'confirmed');
        
        info.innerHTML = `
          <span class="status-tag">CONTRIBUTION RECEIVED!</span><br>
          <small style="font-size:9px">SIG: ${signature.slice(0,20)}...</small>
        `;
        
        // Refresh balance
        setTimeout(() => updateUI(userPublicKey), 3000);

      } catch (err) {
        console.error(err);
        info.innerHTML = `<span style="color: #ff9d9d;">TX FAILED OR DENIED</span>`;
        setTimeout(() => updateUI(userPublicKey), 2500);
      }
    };

    // Persistence logic
    window.addEventListener("load", () => {
      setTimeout(async () => {
        if (localStorage.getItem("launchpad_connected") === "true" && window.solana?.isPhantom) {
          try {
            const res = await window.solana.connect({ onlyIfTrusted: true });
            await updateUI(res.publicKey);
          } catch (err) {
            localStorage.removeItem("launchpad_connected");
          }
        }
      }, 300);
    });
  </script>
</body>
</html>
