<!doctype html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>VOID LAUNCH â€” memecoin crematorium 2026</title>

  <!-- Solana web3 and spl-token (IIFE builds) -->
  <script src="https://unpkg.com/@solana/web3.js@1.95.3/lib/index.iife.min.js"></script>
  <script src="https://unpkg.com/@solana/spl-token@0.4.8/lib/index.iife.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/buffer@6.0.3/index.min.js"></script>

  <style>
    :root{--bg:#000;--accent:#ff00aa;--text:#f0;--glass:rgba(15,0,25,0.85)}
    *{margin:0;padding:0;box-sizing:border-box}
    body{
      min-height:100vh;background:radial-gradient(circle at 50% 50%,#1a0033,#000);
      color:var(--text);font-family:'Courier New',monospace;display:flex;flex-direction:column;
      align-items:center;padding:2rem;
    }
    .container{width:100%;max-width:500px;background:var(--glass);border:1px solid var(--accent);
      padding:2rem;border-radius:15px;box-shadow:0 0 30px rgba(255,0,170,0.3);}
    h1{text-align:center;margin-bottom:1.5rem;letter-spacing:4px;text-shadow:0 0 10px var(--accent);}
    .status-bar{background:rgba(0,0,0,0.5);padding:10px;margin-bottom:20px;text-align:center;font-size:0.9rem;
      border-bottom:1px solid var(--accent);color:#0ff;}
    input,select{width:100%;padding:12px;margin:8px 0;background:#111;border:1px solid #444;color:#fff;border-radius:5px;outline:none;}
    input:focus{border-color:var(--accent);}
    button{width:100%;padding:15px;margin-top:15px;background:var(--accent);color:#000;font-weight:bold;border:none;cursor:pointer;text-transform:uppercase;}
    button:hover{filter:brightness(1.2);} button:disabled{background:#333;color:#666;cursor:not-allowed;}
    .log-box{margin-top:20px;padding:10px;font-size:0.75rem;background:#000;border:1px dashed var(--accent);word-break:break-all;display:none;}
    a{color:#0ff;}
    .warning{color:#ff77aa;font-size:0.9rem;margin-top:0.5rem}
  </style>
</head>
<body>
  <div class="container">
    <h1>VOID LAUNCH</h1>
    <div class="status-bar" id="status">INITIALIZING SYSTEMS...</div>

    <button id="connectBtn">CONNECT PHANTOM</button>

    <form id="launchForm" style="display:none;">
      <input type="text" id="name" placeholder="Token Name (optional)">
      <input type="text" id="symbol" placeholder="Symbol (max 10)" maxlength="10" required>
      <input type="number" id="supply" placeholder="Total Supply (integer)" required min="1" step="1">
      <select id="decimals">
        <option value="9">9 Decimals (Standard)</option>
        <option value="6">6 Decimals (USDC Style)</option>
        <option value="0">0 Decimals (Chaos)</option>
      </select>
      <div class="warning">Revoking mint/freeze authorities is irreversible. Make sure this is desired.</div>
      <button type="submit" id="createBtn">BIRTH THE ABOMINATION</button>
    </form>

    <div id="log" class="log-box" aria-live="polite"></div>
  </div>

<script>
  // Buffer polyfill for browser
  window.Buffer = buffer.Buffer;

  const { Connection, PublicKey, Keypair, Transaction, SystemProgram, ComputeBudgetProgram } = solanaWeb3;
  const {
    TOKEN_PROGRAM_ID,
    createInitializeMintInstruction,
    getAssociatedTokenAddress,
    createAssociatedTokenAccountInstruction,
    createMintToInstruction,
    createSetAuthorityInstruction,
    MINT_SIZE,
    AuthorityType
  } = splToken;

  const statusEl = document.getElementById('status');
  const connectBtn = document.getElementById('connectBtn');
  const launchForm = document.getElementById('launchForm');
  const logBox = document.getElementById('log');

  let provider = null;       // wallet provider object (kept for reuse)
  let userPubkey = null;
  const connection = new Connection("https://api.mainnet-beta.solana.com", "confirmed");

  function log(msg) {
    logBox.style.display = 'block';
    logBox.innerHTML += msg + "<br>";
  }
  function setStatus(t) { statusEl.textContent = t; }

  async function handleConnect() {
    try {
      // Prefer Phantom provider object (window.phantom?.solana) but accept injected window.solana as fallback
      provider = window.phantom?.solana || window.solana;
      if (!provider) {
        setStatus("PHANTOM NOT FOUND");
        // Provide user friendly instructions instead of forcing a new tab
        log('No Phantom wallet detected. Install Phantom from https://phantom.app/');
        return;
      }

      setStatus("AWAITING WALLET APPROVAL...");
      // Request connection
      const resp = await provider.connect();
      // Phantom returns a PublicKey in resp.publicKey
      userPubkey = resp.publicKey;
      setStatus(`CONNECTED: ${userPubkey.toString().slice(0,6)}...${userPubkey.toString().slice(-4)}`);
      connectBtn.style.display = 'none';
      launchForm.style.display = 'block';
    } catch (err) {
      console.error("Connection Error:", err);
      setStatus("CONNECTION REJECTED");
      log("Connection rejected or failed: " + (err?.message || err));
    }
  }

  connectBtn.onclick = handleConnect;

  // Validate inputs
  function validateInputs({ symbol, supply, decimals }) {
    if (!symbol || symbol.trim().length === 0) throw new Error("Symbol is required.");
    if (!/^[A-Za-z0-9-_]{1,10}$/.test(symbol)) throw new Error("Symbol must be 1-10 chars: letters, numbers, - or _.");
    const s = Number(supply);
    if (!Number.isFinite(s) || !Number.isInteger(s) || s <= 0) throw new Error("Supply must be a positive integer.");
    if (![0,6,9].includes(Number(decimals))) throw new Error("Invalid decimals.");
  }

  launchForm.onsubmit = async (e) => {
    e.preventDefault();
    const createBtn = document.getElementById('createBtn');

    const name = document.getElementById('name').value || "";
    const symbol = document.getElementById('symbol').value.trim();
    const supply = document.getElementById('supply').value;
    const decimals = Number(document.getElementById('decimals').value);

    try {
      validateInputs({ symbol, supply, decimals });
    } catch (err) {
      log('<span style="color:#ff9999;">Input error: ' + err.message + '</span>');
      return;
    }

    createBtn.disabled = true;
    createBtn.textContent = "TRANSMITTING...";
    logBox.style.display = 'block';
    log("Initializing Void Protocol...");

    try {
      if (!provider || !userPubkey) throw new Error("Wallet not connected.");
      if (!provider.signTransaction) throw new Error("Wallet does not support signTransaction.");

      const mintKeypair = Keypair.generate();
      const lamports = await connection.getMinimumBalanceForRentExemption(MINT_SIZE);

      // Use BigInt arithmetic for supply * 10**decimals
      const fullSupply = BigInt(supply) * (10n ** BigInt(decimals));

      const transaction = new Transaction();

      // Optional: add compute unit price - don't set extremely high microLamports
      // Keep this conservative; change only if you know what you're doing
      // transaction.add(ComputeBudgetProgram.setComputeUnitPrice({ microLamports: 100000 }));

      // Create mint account + initialize mint (mint authority = user, freeze authority = user)
      transaction.add(
        SystemProgram.createAccount({
          fromPubkey: userPubkey,
          newAccountPubkey: mintKeypair.publicKey,
          space: MINT_SIZE,
          lamports,
          programId: TOKEN_PROGRAM_ID
        }),
        createInitializeMintInstruction(
          mintKeypair.publicKey,
          decimals,
          userPubkey,  // mint authority
          userPubkey   // freeze authority (we will revoke it later)
        )
      );

      // Associated Token Account (ATA) for the creator
      const ata = await getAssociatedTokenAddress(mintKeypair.publicKey, userPubkey);
      transaction.add(
        createAssociatedTokenAccountInstruction(
          userPubkey, // payer
          ata,        // associated token address
          userPubkey, // owner of ATA
          mintKeypair.publicKey
        )
      );

      // Mint everything to the creator's ATA
      transaction.add(
        createMintToInstruction(
          mintKeypair.publicKey,
          ata,
          userPubkey,
          fullSupply
        )
      );

      // Revoke mint and freeze authorities (use AuthorityType constants)
      transaction.add(
        createSetAuthorityInstruction(
          mintKeypair.publicKey,
          userPubkey,
          AuthorityType.MintTokens,
          null // revoke
        ),
        createSetAuthorityInstruction(
          mintKeypair.publicKey,
          userPubkey,
          AuthorityType.FreezeAccount,
          null // revoke
        )
      );

      // Prepare blockhash & fee payer
      const latest = await connection.getLatestBlockhash('confirmed');
      transaction.recentBlockhash = latest.blockhash;
      transaction.feePayer = userPubkey;

      // Partially sign with newly created mint keypair (mint account must sign)
      transaction.partialSign(mintKeypair);

      log("Requesting wallet signature...");
      // Let the wallet sign (adds the wallet signature)
      const signedTx = await provider.signTransaction(transaction);

      // sendRawTransaction and confirm with blockhash + lastValidBlockHeight
      const raw = signedTx.serialize();
      log("Broadcasting transaction...");
      const signature = await connection.sendRawTransaction(raw);

      // confirm using the blockhash + lastValidBlockHeight returned earlier
      await connection.confirmTransaction({
        signature,
        blockhash: latest.blockhash,
        lastValidBlockHeight: latest.lastValidBlockHeight
      }, 'confirmed');

      log(`<strong>SUCCESS.</strong> Token mint: <a href="https://solscan.io/address/${mintKeypair.publicKey.toBase58()}" target="_blank">${mintKeypair.publicKey.toBase58()}</a>`);
      setStatus("VOID BIRTH COMPLETE");
      createBtn.textContent = "BIRTH COMPLETE";
    } catch (err) {
      console.error(err);
      log('<span style="color:red;">FAILED: ' + (err?.message || err) + '</span>');
      createBtn.disabled = false;
      createBtn.textContent = "RETRY BIRTH";
      setStatus("ERROR");
    }
  };
</script>
</body>
</html>
