<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>MC Launchpad — Solana Token Creator (2026 fix)</title>

<!-- Updated versions - best chance in early 2026 -->
<script src="https://unpkg.com/@solana/web3.js@1.95.3/lib/index.iife.min.js"></script>
<script src="https://unpkg.com/@solana/spl-token@0.4.8/lib/index.iife.min.js"></script>

<style>
  *{box-sizing:border-box;font-family:system-ui,-apple-system,sans-serif}
  body{margin:0;min-height:100vh;background:radial-gradient(circle at top,#1a0033,#06000f);color:#e9ddff}
  .frame{position:fixed;inset:10px;border:3px solid #7c3aed;border-radius:24px;box-shadow:0 0 40px rgba(124,58,237,.6);pointer-events:none}
  header{text-align:center;padding:40px 20px}
  header h1{font-size:3.6rem;background:linear-gradient(90deg,#a78bfa,#c084fc);-webkit-background-clip:text;color:transparent}
  .container{max-width:720px;margin:0 auto;background:rgba(15,5,40,.85);border-radius:24px;padding:28px;box-shadow:0 20px 60px rgba(0,0,0,.6)}
  .status{font-size:1.4rem;font-weight:700;text-align:center}
  .balance{text-align:center;font-size:1.1rem;color:#a78bfa;margin:8px 0 18px}
  form{display:grid;gap:12px}
  input,select{padding:12px;border-radius:10px;border:1px solid #5b21b6;background:#0b0220;color:#fff;font-size:1rem}
  button{padding:14px;font-size:1.05rem;font-weight:700;border:none;border-radius:12px;cursor:pointer;background:linear-gradient(90deg,#7c3aed,#a78bfa);color:#fff}
  button:disabled{opacity:.5;cursor:not-allowed}
  #phantomBtn{padding:10px 16px;font-size:1rem;margin-left:12px;border-radius:12px;background:linear-gradient(90deg,#06b6d4,#7c3aed);color:#fff;border:none;cursor:pointer}
  .tokens{margin-top:22px}
  .token{background:rgba(90,0,200,.12);padding:10px;border-radius:10px;margin-bottom:8px;font-size:.95rem;word-break:break-all}
</style>
</head>
<body>
<div class="frame"></div>

<header>
  <h1>MC Launchpad</h1>
  <p>Create Solana tokens • mainnet • 2026 fixed</p>
</header>

<div class="container">
  <div class="status" id="status">NOT CONNECTED</div>
  <div class="balance" id="balance">Balance: — SOL</div>

  <div style="margin:18px 0;text-align:center">
    <button id="phantomBtn" type="button">Connect Phantom</button>
    <small style="display:block;margin-top:8px;opacity:0.7">Real SOL will be spent. Mint & freeze authority will be revoked.</small>
  </div>

  <form id="launchForm">
    <input id="name" placeholder="Token Name" required />
    <input id="symbol" placeholder="Symbol (max 8 chars)" maxlength="8" required />
    <input id="supply" type="number" min="1" placeholder="Total Supply (whole tokens)" required />
    <select id="decimals">
      <option value="9" selected>Decimals: 9 (recommended)</option>
      <option value="6">Decimals: 6</option>
      <option value="0">Decimals: 0</option>
    </select>
    <button id="createBtn" disabled>Create Token</button>
  </form>

  <div class="tokens" id="tokens"></div>
</div>

<script>
// ──────────────────────────────────────────────────────────────
// 2026 FIXED VERSION - using @solana/spl-token@0.4.8 compatible API
// ──────────────────────────────────────────────────────────────

const { Connection, clusterApiUrl, PublicKey, Keypair, Transaction, SystemProgram } = solanaWeb3;
const connection = new Connection(clusterApiUrl("mainnet-beta"), "confirmed");

const TOKEN_PROGRAM_ID = splToken.TOKEN_PROGRAM_ID;
const ASSOCIATED_TOKEN_PROGRAM_ID = splToken.ASSOCIATED_TOKEN_PROGRAM_ID;
const MINT_SIZE = 82; // hardcoded - most reliable in 2026

let walletPublicKey = null;
let provider = null;

const statusEl = document.getElementById("status");
const balanceEl = document.getElementById("balance");
const createBtn = document.getElementById("createBtn");
const tokensList = document.getElementById("tokens");
const phantomBtn = document.getElementById("phantomBtn");

// ─── Phantom detection & connection ─────────────────────────────
function getProvider() {
  if (window?.solana?.isPhantom) return window.solana;
  return null;
}

async function connectWallet() {
  provider = getProvider();
  if (!provider) {
    phantomBtn.textContent = "Install Phantom";
    phantomBtn.onclick = () => window.open("https://phantom.app/", "_blank");
    return;
  }

  try {
    if (provider.isConnected) {
      await provider.disconnect();
    }
    await provider.connect();
  } catch (err) {
    console.error(err);
    alert("Connection failed: " + (err.message || err));
  }
}

provider?.on("connect", (pubkey) => {
  walletPublicKey = new PublicKey(pubkey.toString());
  statusEl.textContent = "CONNECTED TO " + pubkey.toString().slice(0,6) + "..." + pubkey.toString().slice(-6);
  createBtn.disabled = false;
  updateBalance();
});

provider?.on("disconnect", () => {
  walletPublicKey = null;
  statusEl.textContent = "NOT CONNECTED";
  balanceEl.textContent = "Balance: — SOL";
  createBtn.disabled = true;
});

phantomBtn.onclick = connectWallet;

// ─── Balance poller ─────────────────────────────────────────────
async function updateBalance() {
  if (!walletPublicKey) return;
  try {
    const lamports = await connection.getBalance(walletPublicKey);
    balanceEl.textContent = `Balance: ${(lamports / 1e9).toFixed(5)} SOL`;
  } catch {}
}
setInterval(updateBalance, 12000);

// ─── Core token creation logic ──────────────────────────────────
async function createToken() {
  if (!walletPublicKey || !provider) return alert("Wallet not connected");

  const name = document.getElementById("name").value.trim();
  const symbol = document.getElementById("symbol").value.trim();
  const supplyInput = document.getElementById("supply").value.trim();
  const decimals = parseInt(document.getElementById("decimals").value);

  if (!name || !symbol || !supplyInput) return alert("Fill all fields");
  if (isNaN(decimals) || decimals < 0 || decimals > 9) return alert("Invalid decimals");

  const totalSupply = BigInt(supplyInput);
  if (totalSupply <= 0n) return alert("Supply must be > 0");

  createBtn.disabled = true;
  createBtn.textContent = "Creating... (wait 10-30s)";

  try {
    const mint = Keypair.generate();

    const rentExempt = await connection.getMinimumBalanceForRentExemption(MINT_SIZE);

    const tx = new Transaction({ feePayer: walletPublicKey });

    // Create mint account
    tx.add(
      SystemProgram.createAccount({
        fromPubkey: walletPublicKey,
        newAccountPubkey: mint.publicKey,
        space: MINT_SIZE,
        lamports: rentExempt,
        programId: TOKEN_PROGRAM_ID,
      })
    );

    // Initialize mint (authority = wallet)
    tx.add(
      splToken.createInitializeMintInstruction(
        mint.publicKey,
        decimals,
        walletPublicKey,      // mint authority
        walletPublicKey,      // freeze authority (will be revoked later)
        TOKEN_PROGRAM_ID
      )
    );

    // Get / create associated token account
    const ata = await splToken.getAssociatedTokenAddress(
      mint.publicKey,
      walletPublicKey,
      false,
      TOKEN_PROGRAM_ID,
      ASSOCIATED_TOKEN_PROGRAM_ID
    );

    const ataExists = await connection.getAccountInfo(ata);
    if (!ataExists) {
      tx.add(
        splToken.createAssociatedTokenAccountInstruction(
          walletPublicKey, // payer
          ata,
          walletPublicKey, // owner
          mint.publicKey,
          TOKEN_PROGRAM_ID,
          ASSOCIATED_TOKEN_PROGRAM_ID
        )
      );
    }

    // Mint all tokens
    const mintAmount = totalSupply * (10n ** BigInt(decimals));
    tx.add(
      splToken.createMintToInstruction(
        mint.publicKey,
        ata,
        walletPublicKey,
        mintAmount,
        [],
        TOKEN_PROGRAM_ID
      )
    );

    // ── Lock forever (revoke authorities) ───────────────────────
    tx.add(
      splToken.createSetAuthorityInstruction(
        mint.publicKey,
        walletPublicKey,
        0, // MintTokens
        null,
        TOKEN_PROGRAM_ID
      )
    );
    tx.add(
      splToken.createSetAuthorityInstruction(
        mint.publicKey,
        walletPublicKey,
        1, // FreezeAccount
        null,
        TOKEN_PROGRAM_ID
      )
    );

    // Get latest blockhash
    tx.recentBlockhash = (await connection.getLatestBlockhash()).blockhash;

    // Partial sign with mint keypair
    tx.partialSign(mint);

    // Let wallet sign (Phantom)
    const signedTx = await provider.signTransaction(tx);

    // Send & confirm
    const signature = await connection.sendRawTransaction(signedTx.serialize(), {
      skipPreflight: false,
      maxRetries: 3
    });

    await connection.confirmTransaction(signature, "confirmed");

    // Success
    const mintAddr = mint.publicKey.toBase58();
    const el = document.createElement("div");
    el.className = "token";
    el.textContent = `Success → Mint: \( {mintAddr.slice(0,8)}... \){mintAddr.slice(-8)}`;
    tokensList.prepend(el);

    alert(`Token created!\nMint: ${mintAddr}\nTx: ${signature}\nAuthorities revoked (permanent)`);

  } catch (e) {
    console.error(e);
    alert("Failed: " + (e.message || String(e)).slice(0,180));
  } finally {
    createBtn.disabled = false;
    createBtn.textContent = "Create Token";
  }
}

// ─── Event listeners ────────────────────────────────────────────
document.getElementById("launchForm").addEventListener("submit", async e => {
  e.preventDefault();
  await createToken();
});

// Auto-detect if already connected
if (getProvider()?.isConnected) {
  walletPublicKey = new PublicKey(getProvider().publicKey.toString());
  statusEl.textContent = "CONNECTED TO " + walletPublicKey.toBase58().slice(0,6)+"..."+walletPublicKey.toBase58().slice(-6);
  createBtn.disabled = false;
  updateBalance();
}
</script>
</body>
</html>
