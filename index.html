<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SOLANA TOKEN LAUNCHPAD</title>

<!-- WALLET ADAPTER UMD -->
<script src="https://unpkg.com/@solana/web3.js@1.87.6/lib/index.iife.min.js"></script>
<script src="https://unpkg.com/@solana/wallet-adapter-base@0.9.23/lib/index.iife.min.js"></script>
<script src="https://unpkg.com/@solana/wallet-adapter-wallets@0.19.23/lib/index.iife.min.js"></script>
<script src="https://unpkg.com/@solana/wallet-adapter-core@0.11.23/lib/index.iife.min.js"></script>
<script src="https://unpkg.com/@solana/wallet-adapter-ui@0.9.23/lib/index.iife.min.js"></script>

<script src="https://unpkg.com/@solana/spl-token@0.3.9/lib/index.iife.min.js"></script>
<script src="https://unpkg.com/@metaplex-foundation/mpl-token-metadata@2.13.0/dist/index.iife.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/buffer/6.0.3/buffer.min.js"></script>

<script>window.Buffer = buffer.Buffer;</script>

<style>
* { box-sizing: border-box; font-family: system-ui; text-transform: uppercase; }
body {
  margin:0;
  background:#2b0000;
  color:white;
  padding:20px;
}
.card {
  max-width:520px;
  margin:auto;
  background:#3a0000;
  padding:20px;
  border-radius:18px;
}
button {
  width:100%;
  padding:14px;
  border-radius:14px;
  border:none;
  background:white;
  color:#2563eb;
  font-weight:800;
  margin-bottom:12px;
}
input {
  width:100%;
  padding:12px;
  margin-bottom:12px;
  border-radius:12px;
  border:none;
}
.status { margin-top:10px; word-break:break-word }
</style>
</head>

<body>
<div class="card">
  <button id="connect">CONNECT WALLET</button>

  <form id="form" style="display:none">
    <input id="name" placeholder="TOKEN NAME" required />
    <input id="symbol" placeholder="SYMBOL" maxlength="10" required />
    <input id="supply" type="number" value="1000000" required />
    <input id="image" type="file" accept="image/*" required />
    <button type="submit">LAUNCH TOKEN</button>
  </form>

  <div class="status" id="status"></div>
</div>

<script>
const { Connection, PublicKey, Transaction, SystemProgram } = solanaWeb3;
const { TOKEN_PROGRAM_ID, MINT_SIZE, getMinimumBalanceForRentExemptMint,
  createInitializeMintInstruction,
  createAssociatedTokenAccountInstruction,
  getAssociatedTokenAddress,
  createMintToInstruction,
  createSetAuthorityInstruction,
  AuthorityType } = splToken;

const { createCreateMetadataAccountV3Instruction, PROGRAM_ID } = mplTokenMetadata;

const connection = new Connection("https://api.mainnet-beta.solana.com");

const wallets = [
  new solanaWalletAdapterWallets.PhantomWalletAdapter(),
  new solanaWalletAdapterWallets.OKXWalletAdapter(),
  new solanaWalletAdapterWallets.SolflareWalletAdapter()
];

const wallet = new solanaWalletAdapterCore.WalletAdapterNetwork("mainnet-beta");

let currentWallet;

document.getElementById("connect").onclick = async () => {
  for (const w of wallets) {
    try {
      await w.connect();
      currentWallet = w;
      document.getElementById("connect").style.display="none";
      document.getElementById("form").style.display="block";
      return;
    } catch {}
  }
  alert("NO WALLET FOUND");
};

document.getElementById("form").onsubmit = async (e) => {
  e.preventDefault();
  const status = document.getElementById("status");
  status.innerText = "UPLOADING METADATA...";

  const fd = new FormData();
  fd.append("file", image.files[0]);
  fd.append("name", name.value);
  fd.append("symbol", symbol.value);

  const metaRes = await fetch("https://YOUR_BACKEND/upload", { method:"POST", body:fd });
  const { uri } = await metaRes.json();

  status.innerText = "CREATING TOKEN...";

  const mint = solanaWeb3.Keypair.generate();
  const rent = await getMinimumBalanceForRentExemptMint(connection);
  const ata = await getAssociatedTokenAddress(mint.publicKey, currentWallet.publicKey);

  const tx = new Transaction().add(
    SystemProgram.createAccount({
      fromPubkey: currentWallet.publicKey,
      newAccountPubkey: mint.publicKey,
      lamports: rent,
      space: MINT_SIZE,
      programId: TOKEN_PROGRAM_ID
    }),
    createInitializeMintInstruction(mint.publicKey, 9, currentWallet.publicKey, currentWallet.publicKey),
    createAssociatedTokenAccountInstruction(currentWallet.publicKey, ata, currentWallet.publicKey, mint.publicKey),
    createMintToInstruction(mint.publicKey, ata, currentWallet.publicKey,
      BigInt(supply.value) * (BigInt(10) ** BigInt(9))
    ),
    createCreateMetadataAccountV3Instruction({
      metadata: PublicKey.findProgramAddressSync(
        [Buffer.from("metadata"), PROGRAM_ID.toBuffer(), mint.publicKey.toBuffer()],
        PROGRAM_ID
      )[0],
      mint: mint.publicKey,
      mintAuthority: currentWallet.publicKey,
      payer: currentWallet.publicKey,
      updateAuthority: currentWallet.publicKey
    },{
      createMetadataAccountArgsV3:{
        data:{ name:name.value, symbol:symbol.value, uri, sellerFeeBasisPoints:0,
          creators:null, collection:null, uses:null },
        isMutable:true,
        collectionDetails:null
      }
    }),
    createSetAuthorityInstruction(mint.publicKey, currentWallet.publicKey, AuthorityType.MintTokens, null),
    createSetAuthorityInstruction(mint.publicKey, currentWallet.publicKey, AuthorityType.FreezeAccount, null)
  );

  tx.feePayer = currentWallet.publicKey;
  tx.recentBlockhash = (await connection.getLatestBlockhash()).blockhash;
  tx.partialSign(mint);

  const signed = await currentWallet.signTransaction(tx);
  const sig = await connection.sendRawTransaction(signed.serialize());

  status.innerHTML = `SUCCESS<br>${mint.publicKey.toBase58()}<br>${sig}`;
};
</script>
</body>
</html>
